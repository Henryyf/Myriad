# 地图集成功能使用指南

## 🎯 新功能：创建行程时选择国家

现在你可以在创建或编辑行程时手动选择国家/地区，让旅行自动显示在地图上！

## ✨ 工作流程

### 1. 创建新旅行

```
创建旅行表单
├── 标题：Tokyo
├── 国家/地区：🇯🇵 日本  ← 新增！
├── 照片：[添加照片]
├── 日期：2024-01-20
└── 第一条记忆...

[创建]
```

**选择国家后**：
- ✅ 显示提示："将在地图上显示此旅行"
- ✅ 保存时自动关联国家代码
- ✅ 立即在地图上显示

### 2. 编辑现有旅行

```
编辑旅行表单
├── 标题：Tokyo
├── 国家/地区：🇯🇵 日本  ← 可修改！
├── 照片：[更换照片]
└── 日期：...

[保存]
```

## 🗺️ 地图显示逻辑

系统使用**智能双重识别**：

```
1. 优先使用用户选择的国家
   ↓
2. 如果未选择，尝试从标题自动推断
   ↓
3. 如果无法识别，不在地图显示
```

### 示例

| 情况 | 标题 | 选择国家 | 地图显示 |
|------|------|---------|---------|
| A | Tokyo | 🇯🇵 日本 | ✅ 日本 |
| B | Tokyo | 未选择 | ✅ 日本（自动推断）|
| C | MyTrip | 🇨🇦 加拿大 | ✅ 加拿大 |
| D | MyTrip | 未选择 | ❌ 不显示 |

## 📋 支持的国家列表

当前支持 **10 个国家**，按字母顺序排列：

1. 🇦🇺 澳大利亚
2. 🇨🇦 加拿大
3. 🇨🇳 中国
4. 🇫🇷 法国
5. 🇮🇹 意大利
6. 🇯🇵 日本
7. 🇰🇷 韩国
8. 🇹🇭 泰国
9. 🇬🇧 英国
10. 🇺🇸 美国

## 🎨 UI 设计

### 国家选择器（Picker样式）

```
┌─────────────────────────────┐
│ 国家/地区（可选）             │
├─────────────────────────────┤
│ 选择国家    🇯🇵 日本      ▼ │
│                              │
│ 将在地图上显示此旅行          │
└─────────────────────────────┘
```

**特点**：
- 菜单式Picker（不占用太多空间）
- Emoji国旗 + 中文名称
- 可选择"未选择"（移除关联）
- 实时提示效果

## 💾 数据结构

### Trip模型新增字段

```swift
struct Trip {
    var countryCode: String?  // 例如 "JP", "US", "CA"
    // ... 其他字段
}
```

### 数据流

```
用户选择国家
    ↓
保存到 Trip.countryCode
    ↓
TravelStore 持久化
    ↓
TravelMapView 读取并聚合
    ↓
在地图上显示 Marker
```

## 🔧 扩展和修改

### 添加新国家

1. **打开** `CountryFootprint.swift`
2. **在** `CountryInfoProvider.countries` **中添加**：

```swift
"XX": CountryInfo(
    code: "XX",
    name: "新国家",
    flagEmoji: "🇽🇽",
    coordinate: CLLocationCoordinate2D(latitude: xx.xx, longitude: xx.xx),
    description: "一句话介绍"
)
```

3. **完成！** 国家会自动出现在选择器中

### 修改自动推断规则

如果想改进标题自动推断逻辑，编辑：
`CountryInfoProvider.inferCountryCode(from:)`

## ✅ 用户体验改进

### 之前（仅自动推断）
- ❌ 需要使用特定城市名才能识别
- ❌ 无法控制显示的国家
- ❌ "MyTrip"这样的标题无法显示在地图

### 现在（手动选择 + 自动推断）
- ✅ 任意标题都可以关联国家
- ✅ 用户完全控制地图显示
- ✅ 智能回退：忘记选择时自动推断
- ✅ 灵活修改：编辑时可以更改国家

## 📱 最佳实践

### 推荐工作流

1. **创建旅行**
   - 输入标题（城市名或自定义）
   - **手动选择国家**（推荐）
   - 添加照片和日期

2. **查看地图**
   - 自动显示在对应国家
   - 切换状态筛选器查看不同阶段

3. **编辑旅行**
   - 可以随时修改关联的国家
   - 选择"未选择"移除地图显示

### 特殊场景

**多国旅行**（Phase 1 暂不支持）
- 当前一个旅行只能关联一个国家
- 建议：创建多个旅行，每个关联不同国家

**未来功能**（Phase 2+）
- [ ] 一个旅行支持多个国家
- [ ] 从照片EXIF自动识别位置
- [ ] 国家过滤：点击地图国家只显示该国旅行

## 🎉 总结

**已实现**：
- ✅ 创建时手动选择国家
- ✅ 编辑时修改国家
- ✅ 智能双重识别（手动 + 自动）
- ✅ 地图自动更新
- ✅ 10个国家支持
- ✅ 优雅的UI设计

**用户价值**：
- 🎯 精确控制地图显示
- 🚀 任意标题都能显示
- 🎨 清晰的视觉反馈
- 🔧 灵活的编辑能力

---

现在开始使用吧！创建一个新旅行，选择一个国家，立即在地图上看到你的足迹！
